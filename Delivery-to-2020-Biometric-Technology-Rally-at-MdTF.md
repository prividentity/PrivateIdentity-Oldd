## The Maryland Test Facility Public Code Repository

Public code that supports this software integration at the [MdTF Website](https://github.com/TheMdTF/mdtf-public)

## Rally2-matching-system

MdTF has a rally2-matching-system that performs the comparison of biometric types and evaluates the performance of the matching system.

## API

The API definition for matching systems can be found in the [Rally2-Matching-System](https://github.com/TheMdTF/mdtf-public/tree/master/rally2-matching-system/api)

Three API Calls have been exposed:

### 1. `GET /v1/info`

This API call produces a JSON output that explains the information of the algorithm like version, system requirements, and contact details.

_Sample Output:_

`{
    "AlgorithmName": "Private ID Matching Algorithm",
    "AlgorithmType": "Face & Face Mask",
    "AlgorithmVersion": "1.0.0",
    "CompanyName": "Private ID",
    "RecommendedCpus": 4,
    "RecommendedMem": 4096,
    "TechnicalContactEmail": "scott@private.id"
}`


### 2. `POST /v1/create-template`

This API call is responsible for consuming the image data and outputs one or more fully homomorphic encrypted (FHE) payloads. Each FHE payload is a positional arrays of 128 floating-point numbers generated by a custom mobile embedding DNN.  

The recognition system uses FHE payloads to calculate a similarity (geometric distance) between sets of vector data in their encrypted form. The FHE payloads are returned in the form of a base64 encoded string.

FHE payloads are generated for all the images that will be used for comparison

> The API consumes an ImageData in the form of base64 png image string and produces a base64 template string

_Sample Output:_

`{
    "Template": "WzAuMDUwMDcyMjk3NDUzODgwMzEsMC4wNjUwNTE0MjE1MjMwOTQxOCwwLjAxMTI1MjIyOTEwMTk1NTg5LDAuMDU5ODE1MzkxODk4MTU1MjEsLTAuMTUxMjE1NDA0MjcyMDc5NDcsLTAuMTQ5NTE4MTAyNDA3NDU1NDQsMC4wNTA2NzE3NDUwOTE2NzY3MSwtMC4wNDU3NDU4ODY4NjIyNzc5ODUsMC4xMTM2MDg2MzU5NjIwMDk0MywwLjAyOTE5MjgwNzE1Mjg2NzMxNywwLjAzOTM5MDUzNzg4NzgxMTY2LC0wLjEwMTk0ODQxNzcyMzE3ODg2LDAuMDU3MTY1MzE3MjM3Mzc3MTcsMC4wODczNTUzMjMxMzU4NTI4MSwtMC4wMDAyMTMwNzk3OTQ3NzU2OTQ2LDAuMDgyODEyODgyOTU5ODQyNjgsMC4wNDI0OTUwNDU4MTA5Mzc4OCwtMC4xMjIyNjg5NzQ3ODEwMzYzOCwtMC4xMzc3NDUwOTcyNzk1NDg2NSwwLjE2MTk5OTMyOTkyNDU4MzQ0LDAuMDcxMzQ3MzkzMDk1NDkzMzIsLTAuMD=="
}`


### 3. `POST /v1/compare-list`

This API call performs the comparison of the main FHE payloads with all the requested FHE payloads and produces a `Score` and `Normalized Score` for every 1:1 comparison.

`SingleTemplate` holds the template data for comparing with all the other data in the `TemplateList` array. 

The system produces a `ComparisonArray` where for each data in the `TemplateList`, a score and a normalized score will be produced.

_Sample Output:_

`[
    {
        "NormalizedScore": 0.5830713966448668,
        "Score": 0.4269286033551331
    },
    {
        "NormalizedScore": 0,
        "Score": 1.2406864489270033
    }
]`

### Sample Output from MdTF
```$ ./test-routine.sh face 172.17.0.2

Rally Matching System Test Routine Started...
Mode:  face
Host:  172.17.0.2
Port:  8080 

Creating Template for S223-01-t10_01.png
Creating Template for S223-03-t10_01.png
Creating Template for S309-04-t10_01.png
Creating Template for S309-05-t10_01.png
Creating Template for S324-01-t10_01.png
Creating Template for S324-02-t10_01.png
Created 6 templates from 6 images
Average extraction time 425.1666666666 ms per extraction

Compare list generated 6 scores
Compare list generated 6 scores
Compare list generated 6 scores
Compare list generated 6 scores
Compare list generated 6 scores
Compare list generated 6 scores
Performed 36 comparisons
Average comparison time 3.6388888888 ms per comparison

Score Matrix:
0.000 0.480 0.997 0.900 0.958 0.876 
0.480 0.000 0.931 0.839 0.931 0.859 
0.997 0.931 0.000 0.475 1.086 1.088 
0.900 0.839 0.475 0.000 1.040 1.010 
0.958 0.931 1.086 1.040 0.000 0.352 
0.876 0.859 1.088 1.010 0.352 0.000 

Normalized Score Matrix:
1.000 0.530 0.013 0.110 0.052 0.134 
0.530 1.000 0.079 0.171 0.079 0.151 
0.013 0.079 1.000 0.535 0.000 0.000 
0.110 0.171 0.535 1.000 0.000 0.000 
0.052 0.079 0.000 0.000 1.000 0.658 
0.134 0.151 0.000 0.000 0.658 1.000 

... Rally Matching System Test Routine Complete```