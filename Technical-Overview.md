# SYSTEM OVERVIEW 
![Solution Diagram](https://github.com/openinfer/PrivateIdentity/blob/master/images/mfa%20solution%20diagram%201.png)

## Technical Overview (Video)
[![Link to video of technical briefing](https://github.com/openinfer/PrivateIdentity/blob/master/images/Architecture%201%20PLAY.png)](https://youtu.be/T3kSYyMSFzQ "Technical Overview of Cloud Biometric MFA")


The Cloud Biometric MFA system determines if the biometric sample from an untrusted user is valid and matches a previously enrolled subject. The system may present the end user with no UI (i.e. a camera or microphone) or a minimal GUI. 

The system preserves privacy by transmitting, storing and using only system data and not processing any user data (“personal data”), biometric data or biometric templates. As such, it is fully compliant with GDPR, CCPA and BIPA and does not incur legal obligations under these laws (link for additional information on privacy).  
The system authenticates an unlimited number of users online by transmitting FHE payloads to a server, private or public cloud. Identity returns in 300ms. In “off-line mode,” where a network is not present, the system authenticates a maximum of 50 users (dependent on device resources).

Face, face with mask, fingerprint and voice biometric modalities are provided for high risk applications that may require additional biometric authentication mechanisms for step-up authentication. This provides system administrators with the flexibility of requiring a single convenient biometric authentication modality for low-risk applications or more rigorous authentication as needed. The fingerprint biometric modality is recommended to handle difficult cases such as identical twins.

The Cloud Biometric MFA system’s included Web GUI provides automated visual guidance during prediction and enrollment to assist unsupervised and supervised users in acquiring quality biometrics. The system creates an enrollment package 50 FHE payloads to bind the trusted user identifier (a UUID generated by the system) with the authorized user’s private biometric identity. After enrollment, the Cloud Biometric MFA system may store the enrollment package in the secure element of the user’s device to support offline authentication and/or on a server, within the Cloud Biometric MFA system (i.e. GCP Storage and GCP Memorystore).

The Cloud Biometric MFA system’s prediction capability uses a payload of 3 FHE vectors and returns the UUID of an identity or -1 if not found.
 

## Block Diagram 
![Block diagram of the Cloud Biometric MFA system](https://github.com/openinfer/PrivateIdentity/blob/master/images/General%20Block%20Diagram%201.png)
> Cloud Biometric MFA Logical Block Diagram

Cloud Biometric MFA uses fully homomorphic encryption (FHE) methods to ensure privacy, security and confidentiality of the prediction and enrollment packages.  FHE provides secure storage and secure computation by allowing the cloud to calculate the similarity (geometric distance) between two sets of FHE payloads in their encrypted form.
To accomplish this, the system acquires biometrics using a set of helper DNNs and one pre-trained mobile embedding DNN per biometric modality. These DNNs acquire the biometric using a biometric acquisition workflow and then discard (delete) the plaintext biometric after embedding creation.

Cloud Biometric MFA then performs encrypted match and encrypted search using a second set of classifying DNNs. These DNNs classify an unlimited number of FHEs and return identity in constant time when deployed on load-balanced, elastic, fault-tolerant Kubernetes clusters and GCP’s Cloud AI service. Testing at 100,000 FHE payloads/second (simulating 8B authentications/day, or similar to the daily volume of Azure Active Directory) using the above configuration responded in 235ms _constant time_.

* [**Biometric Capture.**](https://github.com/openinfer/PrivateIdentity/wiki/Client-Applications#Web-applications)  The sensor (e.g. phone camera, Webcam, microphone, etc.) acquires a sample of the user’s biometric. 
* [**Geometry DNN**](https://github.com/openinfer/PrivateIdentity/wiki/Biometric-Ingestion-and-Helper-DNNs#face-and-face-wmask-geometry-detection-dnn) - The Geometry DNN determines the (x,y) coordinates of the biometric. 
* [**Validation DNN**](https://github.com/openinfer/PrivateIdentity/wiki/Biometric-Ingestion-and-Helper-DNNs#4-classes-good-blurry-eyeglasses-facemask-validation-dnn) - Validation DNN provides real-time user guidance for acquiring quality biometrics and validates the biometric sample and determines liveness (anti-spoofing).  
* [**Embedding DNN**](https://github.com/openinfer/PrivateIdentity/wiki/Biometric-Ingestion-and-Helper-DNNs#face-facemask-and-fingerprint-embedding-dnns) – The Embedding DNN transforms the validated biometric sample into an encrypted payload (“FHE payload”). 
* **Delete Biometric** – The system then discards (deletes) the original biometric data to eliminate risk of loss and prevent any possible future linkage. 
* **FHE Payload Validation** – Process by which the server verifies the integrity of the FHE payload received by the API endpoint.  
* [**Identification**](https://github.com/openinfer/PrivateIdentity/wiki/Biometric-Matching-Algorithms) – The custom Fully Connected Neural Network (FCNN) running on the Cloud AI service performs an encrypted match or encrypted search.  The UUID returned in the rank 1 position is then provided to the 1:1 Verify function. 
* **1:1 Verify** - The system retrieves the rank 1 UUID’s original FHE enrollment package stored in Cloud Storage and uses procedural programming to calculate the similarity (geometric distance) between the two sets of vector data in their encrypted form. This step is 99.99% accurate and eliminates false positives. 
* Security Management Functions – Cloud Biometric MFA provides management functions for administrators that include deleting users and reviewing audit log information. 

# Architecture Overview
![Architecture on AWS](https://github.com/openinfer/PrivateIdentity/blob/master/images/Architecture%20On-Prem%201.png)
> Generalized Architecture Overview

## Web Tier
The Web Tier provides users with massively horizontally scalable, browser-based biometric enrollment, identity, MFA and account recovery in a convenient Web experience that operates on more than 90% of all browsers, platforms and devices. The Web client uses on-device pre-trained TensorFlow models to acquire, validate, align, crop, transform and 1-way encrypt the biometric. 

The Web Tier does not require on-device training and has no requirement for expensive hardware, cameras, GPUs, batteries or RAM. Devices with multi-threaded kernels operate in millisecond response time. Devices equipped with GPUs and Edge TPUs operate 70-100x faster. Less capable devices operate by offloading processing to Node.js using the “whereToProcess=nodeServer” URL parameter.  The Web tier provides responsive HTML capable of running in most general purpose browsers.  

The <b>Web tier</b> provides the following functionality on a per-biometric-modality basis.

* A local DNN-based [geometry service](https://github.com/openinfer/PrivateIdentity/wiki#geometry-detection-dnns-for-face-face-wmask-fingerprint-eye-and-voice) for finding each instance of a biometric.  For fingerprint, face and face+mask, this returns a bounding rectangle for the biometric or a -1 if the biometric DNN cannot find an instance of the biometric.
* A local DNN-based [validating service](https://github.com/openinfer/PrivateIdentity/wiki#validation-dnns-for-face-face-wmask-and-fingerprint) for determining the validity of an instance of a biometric. For fingerprint, face and face+mask this includes the determining if the biometric is an image spoof, a video spoof, too blurry, glasses on,  mask on, too far or too close.  A JSON string returns the result of the validation check or 0 if none of the anomaly cases are met.  For voice the validity is if the voice has no background noise and is of suitable length.
* A local DNN-based [embedding service](https://github.com/openinfer/PrivateIdentity/wiki#embedding-dnns-for-face-face-wmask-and-fingerprint) for FHE transforming each biometric sample and returning an embedding vector.  This allows the deletion of the original biometric sample. 

There is a separate geometry, validation and embedding DNN for each modality (fingerprint, voice, face and face+mask).

## Server Tier
The <b>server tier </b>is fully homomorphic and only transmits, stores and uses ("processes") data in the encrypted space.  It runs in Python and provides enrollment and prediction services. The Server Tier receives FHE payloads from Web Tier and stores the payloads inside the Database (e.g. Cloud SQL on GCP, RDS on AWS) for persistent storage. For the 1:1 Verify component, the Server Tier performs a comparison between FHE payloads and already-stored FHE payloads from the user's original enrollment in the Database. It returns encrypted results (UUIDs) or -1 (no match) back to the caller.   

### Enrollment
Cloud Biometric MFA [enrollment](https://github.com/openinfer/PrivateIdentity/wiki/IEEE-2410-2020-Standard-for-Biometric-Privacy-(SBP)-Server#API-Enroll-Overview) usually occurs as part of the user’s enrollment into a larger system. The system creates an enrollment package (at least 50 FHE payloads) to bind the trusted user identifier (a UUID generated by the system) with the authorized user’s private biometric identity. After enrollment, the Cloud Biometric MFA system may store the enrollment package in the Web Storage API or the Secure Element API of the local device (for later offline authentication) and/or within the Cloud Biometric MFA system itself (i.e. Cloud SQL and Cloud Memorystore or GCP or Amazon RDS and ElastiCache). 

Fully homomorphic encryption (FHE) methods ensure confidentiality and detect modifications of the enrollment package. 

### Prediction 
The system creates a [prediction package](https://github.com/openinfer/PrivateIdentity/wiki/IEEE-2410-2020-Standard-for-Biometric-Privacy-(SBP)-Server#Predict-Overview) (at least three FHE payloads) from biometric sample(s) captured from the end user. The prediction package is then validated by the FHE payload validation function and an encrypted match is identified by the TensorFlow Extended service (Cloud AI on GCP or SageMaker on AWS). A -1 result is returned if no match is identified. If the TensorFlow Extended service identifies a likely match, this result is used by the 1:1 Verify function to calculate the similarity between FHE payloads in the prediction package and the user’s original enrollment package. An encrypted result (UUID) is returned if a trusted user is identified. If the match is not confirmed by the 1:1 Verify function, a -1 result is returned (no match). 